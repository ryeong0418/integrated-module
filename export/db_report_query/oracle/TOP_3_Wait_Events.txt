WITH SNAP_DATE AS (SELECT SNAP_ID, DBID, INSTANCE_NUMBER, BEGIN_INTERVAL_TIME, END_INTERVAL_TIME
                     FROM DBA_HIST_SNAPSHOT
                    WHERE BEGIN_INTERVAL_TIME >= TRUNC(TO_DATE( '#(StartDate)' , 'YYYYMMDD' ))		--PARAMETER 1 (시작일자)
					  AND BEGIN_INTERVAL_TIME < TRUNC(TO_DATE( '#(EndDate)' , 'YYYYMMDD' )) 	--PARAMETER 1 & PARAMETER 2 (시작일자 & INTERVAL)
					  AND TO_NUMBER(TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')) >= '#(StartTime)'					--PARAMETER3 (시작시간)
					  AND TO_NUMBER(TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')) <'#(EndTime)')				--PARAMETER3 & PARAMETER4 (시작시간 & INTERVAL)
SELECT * FROM (
SELECT A.INSTANCE_NUMBER, -- "INSTANCE_NUMBER"
	   A.SQL_ID, -- "SQL_ID",
       A.SQL_PLAN_HASH_VALUE, -- "Plan Hash Value"
       A.EVENT, -- "Event"
       A.SQL_OPNAME, -- "TOP ROW SOURCE"
       MAX(REPLACE(REPLACE(DBMS_LOB.SUBSTR( B.SQL_TEXT , 100 , 1 ), CHR(13), ' '), CHR(10), ' ')) AS "SQL_TEXT"
FROM DBA_HIST_ACTIVE_SESS_HISTORY A, DBA_HIST_SQLTEXT B, SNAP_DATE C
WHERE A.SNAP_ID = C.SNAP_ID
AND A.DBID = C.DBID
AND A.DBID = B.DBID
AND A.INSTANCE_NUMBER = C.INSTANCE_NUMBER
AND A.SESSION_TYPE = 'FOREGROUND'
AND A.SQL_ID = B.SQL_ID
AND A.event = '#(EVENT_NAME)'			--PARAMETER 5
GROUP BY A.INSTANCE_NUMBER, A.SQL_ID, A.SQL_PLAN_HASH_VALUE, A.EVENT, A.SQL_OPNAME
ORDER BY A.INSTANCE_NUMBER, SUM(WAIT_TIME) DESC)
WHERE ROWNUM <= 3