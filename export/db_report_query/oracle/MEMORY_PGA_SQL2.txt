WITH BASE AS (SELECT INST_ID, PGA_TARGET_FOR_ESTIMATE, PGA_TARGET_FACTOR, ESTD_PGA_CACHE_HIT_PERCENTAGE, ESTD_OVERALLOC_COUNT
				FROM GV$PGA_TARGET_ADVICE
			   WHERE PGA_TARGET_FACTOR = 1)
SELECT X.INST_ID,
	   ROUND(X.PGA_TARGET_FOR_ESTIMATE/1024/1024/1024,1) || DECODE(X.PGA_TARGET_FACTOR,1,'GB(CURRENT)','GB') PGA_SIZE,
	   X.PGA_CACHE_HIT || '%' PGA_CACHE_HIT
FROM (SELECT A.INST_ID,
			 A.PGA_TARGET_FACTOR,
			 A.PGA_TARGET_FOR_ESTIMATE,
			 A.ESTD_PGA_CACHE_HIT_PERCENTAGE - B.ESTD_PGA_CACHE_HIT_PERCENTAGE  AS PGA_CACHE_HIT,
			 ROW_NUMBER() OVER(PARTITION BY A.INST_ID ORDER BY A.ESTD_PGA_CACHE_HIT_PERCENTAGE-B.ESTD_PGA_CACHE_HIT_PERCENTAGE DESC, A.PGA_TARGET_FOR_ESTIMATE ASC) RNK
		FROM GV$PGA_TARGET_ADVICE A, BASE B
	   WHERE A.INST_ID = B.INST_ID) X
WHERE X.RNK = 1