WITH TOT AS (SELECT SUM(ELAPSED_TIME) ELAP_TIME_TOT,
					SUM(CPU_TIME) CPU_TIME_TOT,
					SUM(SHARABLE_MEM) SHARABLE_MEM_TOT
			   FROM GV$SQLAREA
			  WHERE EXECUTIONS > 0
				AND INST_ID = (SELECT INST_ID FROM GV$INSTANCE WHERE INSTANCE_NUMBER = '#(INST_NUM)'))  --PARAMETER1
SELECT B.PARSING_SCHEMA_NAME,
	   B.SQL_ID,
       SUBSTR(REPLACE(REPLACE(B.SQL_TEXT, CHR(13), ' '), CHR(10), ' '),1,30) SQL_TEXT,
	   B.PLAN_CNT,
	   B.LITERAL_CNT,
	   B.EXEC_CNT,
	   (SELECT TO_CHAR(ROUND(B.ELAP_TIME_SUM/TOT.ELAP_TIME_TOT*100,1),'FM990.0') FROM TOT) || '%' AS "ELAPSED_PER",
	   (SELECT TO_CHAR(ROUND(B.CPU_TIME_SUM/TOT.CPU_TIME_TOT*100,1),'FM990.0') FROM TOT) || '%' AS "CPU_TIME_PER",
	   (SELECT TO_CHAR(ROUND(B.SHAR_MEM_SUM/TOT.SHARABLE_MEM_TOT*100,1),'FM990.0') FROM TOT) || '%' AS "SIZE"
  FROM (SELECT A.*
		  FROM (SELECT INST_ID,
					   PARSING_SCHEMA_NAME,
					   SQL_ID,
					   SQL_TEXT,
					   COUNT( DISTINCT PLAN_HASH_VALUE ) OVER ( PARTITION BY FORCE_MATCHING_SIGNATURE ) PLAN_CNT,
					   COUNT( EXACT_MATCHING_SIGNATURE ) OVER( PARTITION BY FORCE_MATCHING_SIGNATURE ) LITERAL_CNT,
					   SUM( EXECUTIONS ) OVER( PARTITION BY FORCE_MATCHING_SIGNATURE ) EXEC_CNT,
					   SUM( ELAPSED_TIME ) OVER( PARTITION BY FORCE_MATCHING_SIGNATURE ) ELAP_TIME_SUM,
					   SUM( CPU_TIME ) OVER( PARTITION BY FORCE_MATCHING_SIGNATURE ) CPU_TIME_SUM,
					   SUM( SHARABLE_MEM ) OVER( PARTITION BY FORCE_MATCHING_SIGNATURE ) SHAR_MEM_SUM,
					   ROW_NUMBER() OVER (PARTITION BY FORCE_MATCHING_SIGNATURE ORDER  BY EXECUTIONS DESC ) RN
				  FROM GV$SQLAREA
				 WHERE EXECUTIONS > 0
				   AND FORCE_MATCHING_SIGNATURE <> 0
				   AND INST_ID = (SELECT INST_ID FROM GV$INSTANCE WHERE INSTANCE_NUMBER = '#(INST_NUM)')) A  --PARAMETER1
		 WHERE A.RN = 1
		ORDER BY A.SHAR_MEM_SUM DESC) B
WHERE ROWNUM <= 20