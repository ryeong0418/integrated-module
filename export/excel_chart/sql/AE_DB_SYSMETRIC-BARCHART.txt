  SELECT DATE_TIME,
        INSTANCE_NUMBER,
        ROUND(AVG(CPU_AVG)) CPU_AVG ,
        ROUND(AVG(AAS_AVG)) AAS_AVG,
        ROUND(MAX(AAS_MAX)) AAS_MAX,
        ROUND(AVG(LIO_AVG)) LIO_AVG,
        ROUND(MAX(LIO_MAX)) LIO_MAX,
        ROUND(AVG(PIO_AVG)) PIO_AVG,
        ROUND(MAX(PIO_MAX)) PIO_MAX,
        ROUND(AVG(EXEC_AVG)) EXEC_AVG,
        ROUND(MAX(EXEC_MAX)) EXEC_MAX,
        ROUND(AVG(HARD_PARSE_AVG)) HARD_PARSE_AVG,
        ROUND(MAX(HARD_PARSE_MAX)) HARD_PARSE_MAX,
        ROUND(AVG(USER_CALLS_AVG)) USER_CALLS_AVG,
        ROUND(MAX(USER_CALLS_MAX)) USER_CALLS_MAX,
        ROUND(AVG(COMMITS_AVG)) COMMITS_AVG,
        ROUND(MAX(COMMITS_MAX)) COMMITS_MAX,
        ROUND(AVG(ROLLBACKS_AVG)) ROLLBACKS_AVG,
        ROUND(MAX(ROLLBACKS_MAX)) ROLLBACKS_MAX
   FROM(
         SELECT A.SNAP_ID,A.INSTANCE_NUMBER,
		        TO_CHAR(A.BEGIN_TIME, 'YYYY-MM-DD ') ||
                CASE WHEN TO_CHAR(A.BEGIN_TIME, 'HH24') BETWEEN '08' AND '09' THEN '09'
                WHEN TO_CHAR(A.BEGIN_TIME, 'HH24') BETWEEN '10' AND '11' THEN '11'
                WHEN TO_CHAR(A.BEGIN_TIME, 'HH24') BETWEEN '12' AND '13' THEN '13'
                WHEN TO_CHAR(A.BEGIN_TIME, 'HH24') BETWEEN '14' AND '15' THEN '15'
                WHEN TO_CHAR(A.BEGIN_TIME, 'HH24') BETWEEN '16' AND '17' THEN '17'
                END DATE_TIME,
                MIN(CASE WHEN A.METRIC_NAME= 'Host CPU Utilization (%)' THEN A.AVERAGE END) CPU_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'Average Active Sessions' THEN A.AVERAGE END) AAS_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'Average Active Sessions' THEN A.MAXVAL END) AAS_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'Logical Reads Per Sec' THEN A.AVERAGE END) LIO_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'Logical Reads Per Sec' THEN A.MAXVAL END) LIO_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'Physical Reads Per Sec' THEN A.AVERAGE END) PIO_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'Physical Reads Per Sec' THEN A.MAXVAL END) PIO_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'Executions Per Sec' THEN A.AVERAGE END) EXEC_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'Executions Per Sec' THEN A.MAXVAL END) EXEC_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'Hard Parse Count Per Sec' THEN A.AVERAGE END) HARD_PARSE_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'Hard Parse Count Per Sec' THEN A.MAXVAL END) HARD_PARSE_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'User Calls Per Sec' THEN A.AVERAGE END) USER_CALLS_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'User Calls Per Sec' THEN A.MAXVAL END) USER_CALLS_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'User Commits Per Sec' THEN A.AVERAGE END) COMMITS_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'User Commits Per Sec' THEN A.MAXVAL END) COMMITS_MAX,
                MIN(CASE WHEN A.METRIC_NAME= 'User Rollbacks Per Sec' THEN A.AVERAGE END) ROLLBACKS_AVG,
                MIN(CASE WHEN A.METRIC_NAME= 'User Rollbacks Per Sec' THEN A.MAXVAL END) ROLLBACKS_MAX
           FROM ae_db_sysmetric A
          WHERE TO_CHAR(A.BEGIN_TIME, 'HH24') BETWEEN '08' AND '17'
          AND TO_CHAR(A.BEGIN_TIME, 'YYYY-MM-DD') >= '#(StartDate)'
          AND TO_CHAR(A.BEGIN_TIME, 'YYYY-MM-DD') < '#(EndDate)'
            AND METRIC_NAME IN ('Host CPU Utilization (%)',
                                'Average Active Sessions',
			                    'Logical Reads Per Sec' ,
								'Physical Reads Per Sec' ,
								'Executions Per Sec',
								'Hard Parse Count Per Sec',
								'User Calls Per Sec' ,
								'User Commits Per Sec' ,
								'User Rollbacks Per Sec'  )
          GROUP BY A.SNAP_ID, A.BEGIN_TIME , A.INSTANCE_NUMBER
		) A
  GROUP BY DATE_TIME, INSTANCE_NUMBER
  ORDER BY 1