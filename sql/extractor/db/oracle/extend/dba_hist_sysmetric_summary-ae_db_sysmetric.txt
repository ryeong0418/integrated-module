SELECT 'AWR' DATA_TYPE ,
       A.SNAP_ID,
       A.INSTANCE_NUMBER,
       (SELECT UPPER( INSTANCE_NAME )
        FROM   DBA_HIST_DATABASE_INSTANCE I
        WHERE  I.INSTANCE_NUMBER=A.INSTANCE_NUMBER
        AND    ROWNUM =1
        ) INSTANCE_NAME ,
       A.BEGIN_TIME,
       A.END_TIME,
       A.METRIC_NAME,
       A.METRIC_UNIT,
       A.MAXVAL,
       A.AVERAGE
FROM   DBA_HIST_SYSMETRIC_SUMMARY A
WHERE TO_CHAR(A.END_TIME, 'YYYY-MM-DD') >= '#(StartDate)'
  AND TO_CHAR(A.END_TIME, 'YYYY-MM-DD') < '#(EndDate)'
