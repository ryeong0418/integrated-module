WITH SNAP_DATE AS (SELECT SNAP_ID, DBID, INSTANCE_NUMBER, BEGIN_INTERVAL_TIME, END_INTERVAL_TIME
                     FROM DBA_HIST_SNAPSHOT
                    WHERE BEGIN_INTERVAL_TIME >= TRUNC(TO_DATE( '#(StartDate)' , 'YYYYMMDD' ))		--PARAMETER 1 (시작일자)
					  AND BEGIN_INTERVAL_TIME < TRUNC(TO_DATE( '#(EndDate)' , 'YYYYMMDD' ))	--PARAMETER 1 & PARAMETER 2 (시작일자 & INTERVAL)
					  AND TO_NUMBER(TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')) >= '#(StartTime)'					--PARAMETER3 (시작시간)
					  AND TO_NUMBER(TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')) < '#(EndTime)')				--PARAMETER3 & PARAMETER4 (시작시간 & INTERVAL)
SELECT TO_CHAR(BEGIN_INTERVAL_TIME, 'MM-DD') MMDD,
       DECODE(MOD(TO_NUMBER(TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')),2),0,TO_CHAR(BEGIN_INTERVAL_TIME+1/24, 'HH24'), TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')) HH24,
	   INSTANCE_NUMBER,
       ROUND(AVG(DECODE(SEC,0,0,BYTES_SENT/SEC)),1) BYTES_SENTPSEC,
       ROUND(AVG(DECODE(SEC,0,0,BYTES_RECEIVED/SEC)),1) BYTES_RECEIVEDPSEC
  FROM (select BEGIN_INTERVAL_TIME, A.INSTANCE_NUMBER,
			   (LEAD(A.BYTES_SENT) OVER (PARTITION BY A.DBID, A.INSTANCE_NUMBER ORDER BY A.SNAP_ID ) - A.BYTES_SENT )/1000000 AS BYTES_SENT ,
			   (LEAD(A.BYTES_RECEIVED) OVER (PARTITION BY A.DBID, A.INSTANCE_NUMBER ORDER BY A.SNAP_ID ) - A.BYTES_RECEIVED )/1000000 AS BYTES_RECEIVED ,
			   EXTRACT( DAY FROM B.END_INTERVAL_TIME-BEGIN_INTERVAL_TIME )*24*60*60
			   +EXTRACT( HOUR FROM B.END_INTERVAL_TIME-BEGIN_INTERVAL_TIME )*60*60
			   +EXTRACT( MINUTE FROM B.END_INTERVAL_TIME-BEGIN_INTERVAL_TIME )*60 SEC
         FROM DBA_HIST_IC_CLIENT_STATS A, SNAP_DATE B
	    WHERE A.DBID = B.DBID
	      AND A.INSTANCE_NUMBER = B.INSTANCE_NUMBER
		  AND A.SNAP_ID = B.SNAP_ID
          AND A.NAME = 'cache')
GROUP BY TO_CHAR(BEGIN_INTERVAL_TIME, 'MM-DD'),
		 DECODE(MOD(TO_NUMBER(TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')),2),0,TO_CHAR(BEGIN_INTERVAL_TIME+1/24, 'HH24'), TO_CHAR(BEGIN_INTERVAL_TIME, 'HH24')),
		 INSTANCE_NUMBER
ORDER BY INSTANCE_NUMBER, MMDD, HH24