SELECT *
FROM   (
        SELECT INSTANCE_NUMBER, 
               PARSING_SCHEMA_NAME ,
               SUM( ELAPSED_TIME_DELTA ) ELAP_TIME ,
               SUM( ELAPSED_TIME_DELTA ) * 100 / SUM( SUM( ELAPSED_TIME_DELTA ) ) OVER() AS "ELA_RATIO(%)",              
               SUM( CPU_TIME_DELTA ) CPU_TIME ,
               SUM( CPU_TIME_DELTA ) * 100 / SUM( SUM( CPU_TIME_DELTA ) ) OVER() AS "CPU_RATIO(%)",
               SUM( IOWAIT_DELTA ) IOWAIT_TIME ,
               SUM( IOWAIT_DELTA ) * 100 / SUM( SUM( IOWAIT_DELTA ) ) OVER() AS "IOWAIT_RATIO(%)" ,
               SUM( EXECUTIONS_DELTA ) EXECUTION ,
               SUM( EXECUTIONS_DELTA ) * 100 / SUM( SUM( EXECUTIONS_DELTA ) ) OVER() AS "EXEC_RATIO(%)",
               SUM( BUFFER_GETS_DELTA ) LIO ,
               SUM( BUFFER_GETS_DELTA ) * 100 / SUM( SUM( BUFFER_GETS_DELTA ) ) OVER() AS "LIO_RATIO(%)",
               SUM( DISK_READS_DELTA ) PIO, 
               SUM( DISK_READS_DELTA ) * 100 / SUM( SUM( DISK_READS_DELTA ) ) OVER() AS "PIO_RATIO(%)",
               ROW_NUMBER () OVER(PARTITION BY INSTANCE_NUMBER ORDER BY SUM( ELAPSED_TIME_DELTA ) DESC ) RNK
        FROM   AE_DB_SQL_STAT  
        WHERE  TO_CHAR(BEGIN_TIME, 'YYYY-MM-DD') >= '#(StartDate)'
           AND  TO_CHAR(END_TIME, 'YYYY-MM-DD') < '#(EndDate)'
        GROUP  BY INSTANCE_NUMBER, PARSING_SCHEMA_NAME      
       ) a
      WHERE RNK <= 10
        ORDER  BY INSTANCE_NUMBER, RNK
 